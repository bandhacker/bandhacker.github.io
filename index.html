<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>optimal.efficient</title>
        <link href="~/favicon.ico" rel="shortcut icon" type="image/x-icon" />

        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <script src="Chart.js"></script>
        <script src="tabletop.js"></script>

        <script src="jquery-1.12.3.js"></script>
        <script src="jquery-ui.js"></script>

        <style>
            #optionsMenu {
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            }
            
            body {
                margin:  0;
                background-color: #F5F5F5;
                font-family:  'Arial Black';
            }
                     
            #topMenu {
                width:  100%;
                height: 46px;
                background-color: black;
                color:  white;
                font-size: 2em;                               
            }
            
            #title {
                display:  inline-block;
            }
                       
            .logo {
                display:  inline-block;
                vertical-align: top;
            }
            
            table, th, td {
                border: solid 1px #7D7D7D;
                border-collapse: collapse;
                padding: 2px;
            }

            #pageText {
                margin-top:  10px;
            }
            
            #dataPane {
                vertical-align:  top;
                display:  inline-block;
                border:  2px solid #7D7D7D;
                border-radius:  2%;
                height:  380px;
                width:  28%;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
          }
            
            #canvasContainer {
                height: 320px;
                width:  320px;
                margin: 0 auto;
                margin-bottom:  5px;
            }
            
            #instrumentationPane {
                vertical-align:  top;
                height: 60px;
                width:  250px;
                margin:  0 auto;                
            }            
           
            .instrument {
                border: 2px solid #7D7D7D;
                height: 18px;
                width: 23px;
                font-size: 0.75em;
                text-align:  center;
            }
            
            #notesPane {
                vertical-align:  top;
                display:  inline-block;
                border: 2px solid #7D7D7D;
                border-radius: 2%;
                width: 20%;
                height: 380px;
                overflow-y: scroll;
                text-align: center;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);    
            }
            
            #notesPane::-webkit-scrollbar {
                width: 6px;
            }
 
            #notesPane::-webkit-scrollbar-track {
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3); 
                border-radius: 6px;
            }
 
            #notesPane::-webkit-scrollbar-thumb {
                border-radius: 6px;
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5); 
            }                        
                       
            #databasePane {
                display:  inline-block;
                border:  2px solid #7D7D7D;
                border-radius:  2%;
                height: 380px;
                width:  50%;
                overflow-y: scroll;
                text-align: center;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);    
            }
            
            #databasePane::-webkit-scrollbar {
                width: 6px;
            }
 
            #databasePane::-webkit-scrollbar-track {
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3); 
                border-radius: 6px;
            }
 
            #databasePane::-webkit-scrollbar-thumb {
                border-radius: 6px;
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5); 
            }   
            
            input {
                display:  block;
                margin:  auto;
            }     
      
            .dbOption {
                vertical-align:  top;
                display:  inline-block;
                width:  14.2857%;
                height: 22px;
                text-align: center;
                color:  white;
                cursor:  default;
                border-top:  1px solid white;
                font-size:  0.9em;
            }
            
            .dbOption.a {
                background:  #636363;
            }
            
            .dbOption.b {
                background:  #7D7D7D;
            }

            .dbOption:hover {
                color: lightblue;
                border-top:  1px solid lightblue;
            }            
                     
            .selectedPiece {
                background-color: yellow;
            }
            
            .pieceSelect {
                font-size:  0.7em;
            }
            
            #allPieces {
                width: 95%;
            }
            
            th {
                background-color: black;
                color:  white;
            }
            
            .trueBasic {
                background-color:  green;                
            }
            
            .trueAdvanced {
                background-color: orange;
            }
            
            .ratingsCount {
                background-color:  #46eb57;
                font-size:  1em;
                border-top:  2px solid black;
                border-bottom:  2px solid black;
                margin-top: 2px;
            }
            
            .noNotes {
                background-color: red;
                color:  white;
                font-size:  0.65em;
                border-top:  2px solid black;
                border-bottom:  2px solid black;
                margin-top: 2px;
            }
                        
            .difficultyNote {
                background-color:  lightblue;
                font-size:  0.65em;
                border-top:  2px solid black;
                border-bottom:  2px solid black;
                margin-top: 2px;
            }
            
            .instrumentationNote {
                background-color: orange;
                font-size:  0.65em;
                border-top:  2px solid black;
                border-bottom:  2px solid black;
                margin-top: 2px;
            }
            
            #numberOfPercussion {
                background-color: white;
            }
            
            #allPieces {
                margin-left:  1%;
                width:  97%;
            }
            
            #otherTools, #trainingLink, #changeLog {
                position:  fixed;
                bottom:  0;                
                width:  15%;
                height:  5%;
                background-color: white;
                text-align: center;
                cursor:  default;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            }
            
            #otherTools:hover, #trainingLink:hover, #changeLog:hover {
                background-color: lightblue;
            }
            
            #changeLog {
                right:  34%;
            }
            
            #otherTools {
                right:  18%;
            }
            
            #trainingLink {
                right:  2%;
            }

            #pageCover {
                position:  fixed;
                top:  0;
                bottom:  0;
                left:  0;
                right:  0;
                background-color: black;
                opacity:  0.5;
            }
            
            #overlayPane {
                background-color: white;
                position:  fixed;
                top: 5%;
                bottom:  6%;
                right:  20%;
                left:  20%;
                opacity:  1.0;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            }

            #buffer{
                height: 20%;
            }
            
            #userEmail, #userBand {
                width: 80%;
                display: block;
                outline: none;
                border: none;
                border-left: 2px solid black;
                height: 25px;
                line-height: 25px;
                font-size: 16px;
                padding: 0;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
                margin-top:  8px;
            }

            #loginButton, #newAccountButton {
                background: black;
                border: none;
                padding: 10px 20px 10px 20px;
                border-bottom: 3px solid white;
                border-radius: 3px;
                color: white;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
                margin-top:  8px;
            }
            
            #loginButton:hover, #newAccountButton:hover {
                border-bottom: 3px solid lightblue;
                color: lightblue;
            }
            
            #loginButton:disabled {
                background-color: grey;
                color: lightgrey;
                border-bottom: 3px solid lightgrey;
            }      
            
            #intro {
                width:  80%;
                margin:  auto;
                background-color:  black;
                color:  white;
                margin-top:  10%;
                font-size:  1.6em;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            }

            .loader {
                left: 50%;
                top: 50%;
                z-index: 1;
                width: 60px;
                height: 60px;
                margin: 40% auto;
                border: 8px solid grey;
                border-radius: 50%;
                border-top: 8px solid lightblue;
                animation: spin 2s linear infinite;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }

                100% {
                    transform: rotate(360deg);
                }
            }
            
            #emailLink:hover {
                color: darkgrey;
                cursor: pointer;
            }
            
            #info {
                position:  absolute;
                left:  0;
                bottom:  0;
                padding:  10px;
                font-size:  0.8em;
            }
        </style>
    </head>
      
    <body>
        <div id="topMenu">
            <div class="logo"><a href="http://optimal-efficient.github.io"><img src="oe.png" height="42px" alt="optimal.efficient"/></a></div>
            <div id="title">optimal.efficient</div>          
        </div>

        <div id="optionsMenu">        
            <div class="dbOption a" id="search" onclick="searchForPiece();">Search
            </div><div class="dbOption b" id="listOptimal" onclick="listOptimalPieces();">List Optimal
            </div><div class="dbOption a" id="listAllPlayable" onclick="listPlayablePieces();">List Playable
            </div><div class="dbOption b" id="listChallenge" onclick="listChallengePieces();">List Challenging
            </div><div class="dbOption a" id="listAll" onclick="listAllPieces();">List All
            </div><div class="dbOption b" id="submitAnalysis" onclick="openWindow('https://docs.google.com/forms/d/e/1FAIpQLSe5q7jbSlC4H0u8NPEeAaniK09N4vqj9ZoStJSBG3R4SQsgUQ/viewform')">Submit Analysis
            </div><div class="dbOption a" id="reportDuplicate">Report Duplicate</div>            
        </div>

        <div id="pageText">
            <div id="dataPane">
                <div id="buffer"></div>
                    <form autocomplete="on">
                        <input name="userEmail" type="text" placeholder="email" id="userEmail">
                        <input name="userBandName" type="text" placeholder="band name" id="userBand">
                        <input type="button" name="login" value="Load Band" id="loginButton" disabled>
                        <input type="button" name="newAccount" value="New Band" id="newAccountButton" onclick="openWindow('https://docs.google.com/forms/d/e/1FAIpQLSf7CKt6BjXfYagKP9XWO74g6PdyYAiAoWhEcvCfUinXGbpcDA/viewform')">
                    </form>                               
            </div>
            <div id="notesPane"></div>
            <div id="databasePane">
                <div id="intro">New? Check out the tutorial below!</div>
            </div>
        </div>        

        <div id="info">Version 0.3.1 (Beta) <br />
        &copy; 2017 Seth Taft <br />
            <span id="emailLink" onclick="openWindow('mailto:optimal.efficient@gmail.com')">optimal.efficient@gmail.com</span>
        </div>

        <div id="changeLog" onclick="openChangeLog()">Change Log</div>
        <div id="otherTools" onclick="openOther()">Other Tools</div>
        <div id="trainingLink" onclick="openTutorial()">Tutorial</div>

        <script>
            //Variables
            var currentUser = {
                user: null,
                elementOne: 0,
                elementTwo: 0,
                elementThree: 0,
                elementFour: 0,
                elementFive: 0,
                elementSix: 0
            };

            var currentPiece = {
                title: "None Selected",
                difficultyNotes: [],
                instrumentationNotes: []
            };

            var activePieceList = [];
            var listOfUsers;
            var pieceList;
            var numberOfPieces;
            var piecesLoaded = false;
            var searchFor;
            var searchTitle;
            var searchComposer;
            var searchArranger;
            var cookiesExist;

            //Startup
            Tabletop.init({ key: '1Wo1RArWUmqVJ9KBjiT2W7B4Tx3KeUsy1sPYPjulcr5I',
                callback: function (data, tabletop) {
                    listOfUsers = data;
                    $('#loginButton').removeAttr('disabled');
                },
                simpleSheet: true
            });

            if (getCookie("band") !== "" && getCookie("email") !== "") {
                cookiesExist = true;
                document.getElementById('userEmail').value = getCookie('email');
                document.getElementById('userBand').value = getCookie('band');
            };

            //Functions
            function addGraphCanvas() {
                $('#dataPane').empty();
                $('#dataPane').append(
                '<div id="canvasContainer">' +
                    '<canvas id="myBand" width="320" height="320"></canvas>' +
                '</div>' +
                '<div id="instrumentationPane">' +
                    '<table id="instrumentationTable">' +
                        '<tr>' +
                            '<td id="oneFlute" class="instrument">F</td>' +
                            '<td id="twoClarinets" class="instrument">C</td>' +
                            '<td id="threeSaxophones" class="instrument">X</td>' +
                            '<td id="oneHorn" class="instrument">H</td>' +
                            '<td id="twoTrumpets" class="instrument">T</td>' +
                            '<td id="oneTrombone" class="instrument">R</td>' +
                            '<td id="baritone" class="instrument">B</td>' +
                            '<td id="tuba" class="instrument">U</td>' +
                            '<td id="sixPercussion" class="instrument">P</td>' +
                        '</tr>' +
                        '<tr>' +
                            '<td id="moreFlutes" class="instrument">F+</td>' +
                            '<td id="moreClarinets" class="instrument">C+</td>' +
                            '<td id="moreSaxophones" class="instrument">X+</td>' +
                            '<td id="moreHorns" class="instrument">H+</td>' +
                            '<td id="moreTrumpets" class="instrument">T+</td>' +
                            '<td id="moreTrombones" class="instrument">R+</td>' +
                            '<td id="oboe" class="instrument">O</td>' +
                            '<td id="bassoon" class="instrument">OO</td>' +
                            '<td id="numberOfPercussion" class="instrument"></td>' +
                       '</tr>' +
                    '</table>' +
                '</div>'
                );
            };

            function openOther() {
                $('body').append('<div id="pageCover" onclick="closeOverlay()"></div>');
                $('body').append('<div id="overlayPane"></div>');
                $('#overlayPane').html('<object type="text/html" data="blindAuditioner.html" width="100%" height="100%"></object>');
            };

            function openTutorial() {
                $('body').append('<div id="pageCover" onclick="closeOverlay()"></div>');
                $('body').append('<div id="overlayPane"></div>');
                $('#overlayPane').html('<object type="text/html" data="training.html" width="100%" height="100%"></object>');
            };

            function openChangeLog() {
                $('body').append('<div id="pageCover" onclick="closeOverlay()"></div>');
                $('body').append('<div id="overlayPane"></div>');
                $('#overlayPane').html('<object type="text/html" data="changeLog.html" width="100%" height="100%"></object>');
            };

            function closeOverlay() {
                $('#pageCover').remove();
                $('#overlayPane').remove();
                $('#closeTutorial').remove();
            };

            function clearCommentsAndInstrumentation() {
                $('#notesPane').empty();
                $('#numberOfPercussion').empty();
                $('#databasePane').empty();
                $('.trueBasic').removeClass('trueBasic');
                $('.trueAdvanced').removeClass('trueAdvanced');
            };

            //Link Buttons
            function openWindow(url) {
                var win = window.open(url, '_blank');
                if (win) {
                    win.focus();
                } else {
                    alert('Please allow popups for this website');
                };
            };

            $('#reportDuplicate').click(function () {
                openWindow('mailto:optimal.efficient@gmail.com?subject=Possible%20Duplicate%20Piece&body=I have discovered a possible duplicate piece in the optimal.efficient database. The two entries are...');
            });

            //Mobile
            function detectmob() {
                if (navigator.userAgent.match(/Android/i)
                         || navigator.userAgent.match(/webOS/i)
                         || navigator.userAgent.match(/iPhone/i)
                         || navigator.userAgent.match(/iPad/i)
                         || navigator.userAgent.match(/iPod/i)
                         || navigator.userAgent.match(/BlackBerry/i)
                         || navigator.userAgent.match(/Windows Phone/i)
                         ) {
                    return true;
                }
                else {
                    return false;
                };
            };

            if (detectmob()) {
                alert('This site is not optimized for mobile. For best results, use your desktop or laptop.')
            };

            //Cookies
            function setCookie(cname, cvalue, exdays) {
                var d = new Date();
                d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                var expires = "expires=" + d.toUTCString();
                document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
            };

            function getCookie(cname) {
                var name = cname + "=";
                var ca = document.cookie.split(';');
                for (var i = 0; i < ca.length; i++) {
                    var c = ca[i];
                    while (c.charAt(0) == ' ') {
                        c = c.substring(1);
                    }
                    if (c.indexOf(name) === 0) {
                        return c.substring(name.length, c.length);
                    }
                }
                return "";
            };

            //Math
            function findMean(array) {
                var mean = 0;

                for (var p = 0; p < array.length; p++) {
                    mean += array[p];
                };

                mean = mean / array.length;

                return mean;
            };

            function findMode(array, ifNoMode) {
                var largestValueCount = 0;
                var largestValue;
                var noLargestValue = false;

                for (var z = 0; z < array.length; z++) {
                    var currentValue = array[z];
                    var currentValueCount = 1;

                    for (var y = 0; y < array.length; y++) {
                        if (z !== y && array[z] == array[y]) {
                            currentValueCount++;
                        };
                    };

                    if (currentValueCount > largestValueCount) {
                        largestValueCount = currentValueCount;
                        largestValue = array[z];
                        noLargestValue = false;
                    };
                    if (currentValueCount == largestValueCount && currentValue !== largestValue) {
                        noLargestValue = true;
                    };
                };

                if (noLargestValue) {
                    return ifNoMode;
                }
                else {
                    return largestValue;
                };
            };

            function changeInstrumentation(piece) {
                $('.trueBasic').removeClass('trueBasic');
                $('.trueAdvanced').removeClass('trueAdvanced');

                if (piece['Flutes'] !== '0') {
                    $('#oneFlute').addClass('trueBasic');
                };

                if (piece['Clarinets'] !== '0') {
                    $('#twoClarinets').addClass('trueBasic');
                };

                if (piece['Saxophones'] !== 'Less than ATB') {
                    $('#threeSaxophones').addClass('trueBasic');
                };

                if (piece['Horns'] !== '0') {
                    $('#oneHorn').addClass('trueBasic');
                };

                if (piece['Trumpets'] !== '0') {
                    $('#twoTrumpets').addClass('trueBasic');
                };

                if (piece['Trombones'] !== '0') {
                    $('#oneTrombone').addClass('trueBasic');
                };

                if (piece['Percussion'] !== '0') {
                    $('#sixPercussion').addClass('trueBasic');
                };

                if (piece['Baritone'] == 'Yes') {
                    $('#baritone').addClass('trueBasic');
                };

                if (piece['Tuba'] == 'Yes') {
                    $('#tuba').addClass('trueBasic');
                };

                if (piece['Flutes'] == '2+') {
                    $('#moreFlutes').addClass('trueAdvanced');
                };

                if (piece['Clarinets'] == '3+') {
                    $('#moreClarinets').addClass('trueAdvanced');
                };

                if (piece['Saxophones'] == 'AATB') {
                    $('#moreSaxophones').addClass('trueAdvanced');
                };

                if (piece['Oboe'] == 'Yes') {
                    $('#oboe').addClass('trueAdvanced');
                };

                if (piece['Bassoon'] == 'Yes') {
                    $('#bassoon').addClass('trueAdvanced');
                };

                if (piece['Trombones'] == '2+') {
                    $('#moreTrombones').addClass('trueAdvanced');
                };

                if (piece['Trumpets'] == '3+') {
                    $('#moreTrumpets').addClass('trueAdvanced');
                };

                if (piece['Horns'] == '2+') {
                    $('#moreHorns').addClass('trueAdvanced');
                };

                if ((piece['Percussion']) > 5) {
                    $('#sixPercussion').removeClass('trueBasic');
                    $('#sixPercussion').addClass('trueAdvanced');
                };

                $('#numberOfPercussion').html(piece['Percussion']);
            };

            function addNotes(piece) {
                $('#notesPane').empty();

                if (piece['Number of Ratings'] == 1) {
                    $('#notesPane').append('<div class="ratingsCount">' + piece['Number of Ratings'] + ' Rating' + '</div>');
                }
                else {
                    $('#notesPane').append('<div class="ratingsCount">' + piece['Number of Ratings'] + ' Ratings' + '</div>');
                };


                if (piece['Difficulty Notes'].length == 0 && piece['Instrumentation Notes'].length == 0) {
                    $('#notesPane').append('<div class="noNotes">No Notes Yet</div>');
                };

                for (var g = 0; g < piece['Difficulty Notes'].length; g++) {
                    $('#notesPane').append('<div class="difficultyNote">' + piece['Difficulty Notes'][g] + '</div>');
                };

                for (var g = 0; g < piece['Instrumentation Notes'].length; g++) {
                    $('#notesPane').append('<div class="instrumentationNote">' + piece['Instrumentation Notes'][g] + '</div>');
                };
            };

            function loadPieces(callback) {
                Tabletop.init({ key: "1vptbIS_PexH6J8N8KRm1EfJ6nj5rAKmImzLk3_j2eew",
                    callback: function (data, tabletop) {
                        pieceList = data;
                        numberOfPieces = pieceList.length;
                        var g = 0;
                        activePieceList = [];

                        for (var i = 0; i < numberOfPieces; i++) {
                            var testTwo = checkForDuplicates(i);

                            if (testTwo !== false) {
                                activePieceList.push(testTwo);
                                g++;
                            };
                        };

                        numberOfPieces = activePieceList.length;
                        activePieceList.sort(function (a, b) { return (a['Title'] > b['Title']) ? 1 : ((b['Title'] > a['Title']) ? -1 : 0); });
                        pieceListLoading = false;

                        piecesLoaded = true;
                        if (callback) { callback(); };
                    },
                    simpleSheet: true
                });
            };

            function createClickablePiecesANDdisplayGraph() {
                $('.pieceSelect').on('click', function () {
                    $('.selectedPiece').removeClass('selectedPiece');
                    $(this).addClass('selectedPiece');

                    var idNo = $(this).attr("id") / 1;

                    currentPiece = {
                        title: "None Selected"
                    };

                    currentPiece.title = activePieceList[idNo]['Title'];
                    currentPiece.elementOne = activePieceList[idNo]['Rapidity'] / 1;
                    currentPiece.elementTwo = activePieceList[idNo]['Rhythm'] / 1;
                    currentPiece.elementThree = activePieceList[idNo]['Dynamics'] / 1;
                    currentPiece.elementFour = activePieceList[idNo]['Texture'] / 1;
                    currentPiece.elementFive = activePieceList[idNo]['Tonality'] / 1;
                    currentPiece.elementSix = activePieceList[idNo]['Range'] / 1;

                    changeInstrumentation(activePieceList[idNo]);
                    addNotes(activePieceList[idNo]);
                    createGraph();
                });
            };

            //Check for Duplicates
            function checkForDuplicates(t) {
                var alreadyDone = false;
                var pieceInQuestion = false;

                for (var a = 0; a < t; a++) {
                    if (pieceList[t]['Title'].toUpperCase() == pieceList[a]['Title'].toUpperCase() && pieceList[t]['Composer'].toUpperCase() == pieceList[a]['Composer'].toUpperCase() && pieceList[t]['Arranger'].toUpperCase() == pieceList[a]['Arranger'].toUpperCase() && pieceList[t]['Publisher'].toUpperCase() == pieceList[a]['Publisher'].toUpperCase()) {
                        alreadyDone = true;
                    };
                };

                if (!alreadyDone) {
                    pieceInQuestion = {}

                    pieceInQuestion['Title'] = pieceList[t]['Title'];
                    pieceInQuestion['Composer'] = pieceList[t]['Composer'];
                    pieceInQuestion['Publisher'] = pieceList[t]['Publisher'];
                    pieceInQuestion['Arranger'] = pieceList[t]['Arranger'];
                    pieceInQuestion['Rapidity'] = [];
                    pieceInQuestion['Rhythm'] = [];
                    pieceInQuestion['Dynamics'] = [];
                    pieceInQuestion['Texture'] = [];
                    pieceInQuestion['Tonality'] = [];
                    pieceInQuestion['Range'] = [];
                    pieceInQuestion['Flutes'] = [];
                    pieceInQuestion['Clarinets'] = [];
                    pieceInQuestion['Saxophones'] = [];
                    pieceInQuestion['Oboe'] = [];
                    pieceInQuestion['Bassoon'] = [];
                    pieceInQuestion['Trumpets'] = [];
                    pieceInQuestion['Horns'] = [];
                    pieceInQuestion['Trombones'] = [];
                    pieceInQuestion['Baritone'] = [];
                    pieceInQuestion['Tuba'] = [];
                    pieceInQuestion['Percussion'] = [];
                    pieceInQuestion['Difficulty Notes'] = [];
                    pieceInQuestion['Instrumentation Notes'] = [];
                    pieceInQuestion['Number of Ratings'] = 0;

                    for (var a = t; a < numberOfPieces; a++) {
                        if (pieceList[t]['Title'] == pieceList[a]['Title'] && pieceList[t]['Composer'] == pieceList[a]['Composer'] && pieceList[t]['Arranger'] == pieceList[a]['Arranger'] && pieceList[t]['Publisher'] == pieceList[a]['Publisher']) {
                            pieceInQuestion['Rapidity'].push(pieceList[a][' [Rapidity]'] / 1);
                            pieceInQuestion['Rhythm'].push(pieceList[a][' [Rhythm]'] / 1);
                            pieceInQuestion['Dynamics'].push(pieceList[a][' [Dynamics]'] / 1);
                            pieceInQuestion['Texture'].push(pieceList[a][' [Texture]'] / 1);
                            pieceInQuestion['Tonality'].push(pieceList[a][' [Tonality]'] / 1);
                            pieceInQuestion['Range'].push(pieceList[a][' [Range]'] / 1);
                            pieceInQuestion['Flutes'].push(pieceList[a]['Flutes']);
                            pieceInQuestion['Clarinets'].push(pieceList[a]['Clarinets']);
                            pieceInQuestion['Saxophones'].push(pieceList[a]['Saxophones']);
                            pieceInQuestion['Oboe'].push(pieceList[a]['Oboe']);
                            pieceInQuestion['Bassoon'].push(pieceList[a]['Bassoon']);
                            pieceInQuestion['Trumpets'].push(pieceList[a]['Trumpets']);
                            pieceInQuestion['Horns'].push(pieceList[a]['Horns']);
                            pieceInQuestion['Trombones'].push(pieceList[a]['Trombones']);
                            pieceInQuestion['Baritone'].push(pieceList[a]['Baritone']);
                            pieceInQuestion['Tuba'].push(pieceList[a]['Tuba']);
                            pieceInQuestion['Percussion'].push(pieceList[a]['Percussion'] / 1);
                            pieceInQuestion['Number of Ratings']++;

                            if (pieceList[a]['Difficulty Notes'] !== "") {
                                var diff = pieceList[a]['Difficulty Notes'];
                                var diff2 = diff.split('.');

                                for (var h = 0; h < (diff2.length - 1); h++) {
                                    var thisn = diff2[h] + '.';
                                    pieceInQuestion['Difficulty Notes'].push(thisn);
                                };
                            };

                            if (pieceList[a]['Instrumentation Notes'] !== "") {
                                var diff = pieceList[a]['Instrumentation Notes'];
                                var diff2 = diff.split('.');

                                for (var h = 0; h < (diff2.length - 1); h++) {
                                    var thisn = diff2[h] + '.';
                                    pieceInQuestion['Instrumentation Notes'].push(thisn);
                                };
                            };
                        };
                    };

                    pieceInQuestion['Rapidity'] = Math.round(findMean(pieceInQuestion['Rapidity']));
                    pieceInQuestion['Rhythm'] = Math.round(findMean(pieceInQuestion['Rhythm']));
                    pieceInQuestion['Dynamics'] = Math.round(findMean(pieceInQuestion['Dynamics']));
                    pieceInQuestion['Texture'] = Math.round(findMean(pieceInQuestion['Texture']));
                    pieceInQuestion['Tonality'] = Math.round(findMean(pieceInQuestion['Tonality']));
                    pieceInQuestion['Range'] = Math.round(findMean(pieceInQuestion['Range']));
                    pieceInQuestion['Flutes'] = findMode(pieceInQuestion['Flutes'], '1');
                    pieceInQuestion['Clarinets'] = findMode(pieceInQuestion['Clarinets'], '1-2');
                    pieceInQuestion['Saxophones'] = findMode(pieceInQuestion['Saxophones'], 'ATB');
                    pieceInQuestion['Oboe'] = findMode(pieceInQuestion['Oboe'], 'No');
                    pieceInQuestion['Bassoon'] = findMode(pieceInQuestion['Bassoon'], 'No');
                    pieceInQuestion['Trumpets'] = findMode(pieceInQuestion['Trumpets'], '1-2');
                    pieceInQuestion['Horns'] = findMode(pieceInQuestion['Horns'], '1');
                    pieceInQuestion['Trombones'] = findMode(pieceInQuestion['Trombones'], '1');
                    pieceInQuestion['Baritone'] = findMode(pieceInQuestion['Baritone'], 'Yes');
                    pieceInQuestion['Tuba'] = findMode(pieceInQuestion['Tuba'], "Yes");
                    pieceInQuestion['Percussion'] = Math.ceil(findMean(pieceInQuestion['Percussion']));
                };

                return pieceInQuestion;
            };

            //Create Graph
            function createGraph() {
                var myChart = new Chart("myBand", {
                    type: 'radar',
                    data: {
                        labels: ["Rapidity", "Rhythm", "Dynamics", "Texture", "Tonality", "Range"],
                        datasets: [
                                                                                                         {
                                                                                                             label: currentUser.user,
                                                                                                             fillColor: "rgba(220,220,440,0.4)",
                                                                                                             strokeColor: "rgba(220,220,440,1)",
                                                                                                             pointColor: "rgba(220,220,440,1)",
                                                                                                             pointStrokeColor: "#fff",
                                                                                                             pointHighlightFill: "#fff",
                                                                                                             pointHighlightStroke: "rgba(220,220,220,1)",
                                                                                                             backgroundColor: "rgba(0, 0, 255, 0.2)",
                                                                                                             borderColor: "rgba(0, 0, 255, 0.2)",
                                                                                                             data: [
                                                                                                                     currentUser.elementOne,
                                                                                                                     currentUser.elementTwo,
                                                                                                                     currentUser.elementThree,
                                                                                                                     currentUser.elementFour,
                                                                                                                     currentUser.elementFive,
                                                                                                                     currentUser.elementSix
                                                                                                                   ]
                                                                                                         },
                                                                                                         {
                                                                                                             label: currentPiece.title,
                                                                                                             fillColor: "rgba(440,220,320,0.4)",
                                                                                                             strokeColor: "rgba(440,220,220,1)",
                                                                                                             pointColor: "rgba(440,220,220,1)",
                                                                                                             pointStrokeColor: "#fff",
                                                                                                             pointHighlightFill: "#fff",
                                                                                                             pointHighlightStroke: "rgba(440,220,220,1)",
                                                                                                             backgroundColor: "rgba(255, 0, 0, 0.2)",
                                                                                                             borderColor: "red",
                                                                                                             data: [
                                                                                                                     currentPiece.elementOne,
                                                                                                                     currentPiece.elementTwo,
                                                                                                                     currentPiece.elementThree,
                                                                                                                     currentPiece.elementFour,
                                                                                                                     currentPiece.elementFive,
                                                                                                                     currentPiece.elementSix
                                                                                                                   ]
                                                                                                         }
                                                                                                     ]
                    },
                    options: {
                        scale: {
                            ticks: {
                                beginAtZero: true,
                                max: 6
                            }
                        }
                    }
                });
            };

            function listAllPieces() {
                if (piecesLoaded) {
                    $('#databasePane').empty();
                    $('#databasePane').append('<table id="allPieces"><tr><th>Title</th><th>Composer</th><th>Arranger</th><th>Publisher</th></tr></table>');

                    for (var i = 0; i < numberOfPieces; i++) {
                        var loadInfo = activePieceList[i];

                        $('#allPieces').append('<tr class="pieceSelect" id="' + i + '"><td>' + loadInfo['Title'] + '</td><td>' + loadInfo['Composer'] + '</td><td>' + loadInfo['Arranger'] + '</td><td>' + loadInfo['Publisher'] + '</td></tr>')

                    };
                    createClickablePiecesANDdisplayGraph();
                };
            };

            function searchForPiece() {
                if (piecesLoaded) {
                    //Generate Search Screen
                    $('#databasePane').empty();
                    $('#databasePane').append(
                                        'Search Title<input id="searchTitle" type="checkbox" name="searchIn" value="Title">' +
                                        'Search Composer<input id="searchComposer" type="checkbox" name="searchIn" value="Composer">' +
                                        'Search Arranger<input id="searchArranger" type="checkbox" name="searchIn" value="Arranger"><br />'
                                    );
                    $('#databasePane').append('<input name="searchTerm" type="text" placeholder="search for a piece" id="searchTerm"><br />');
                    $('#databasePane').append('<input type="button" name="executeSearch" value="Search" id="searchButton">');

                    //When "Search" is Clicked
                    $('#searchButton').on('click', function () {
                        searchTitle = document.getElementById("searchTitle").checked;
                        searchComposer = document.getElementById("searchComposer").checked;
                        searchArranger = document.getElementById("searchArranger").checked;
                        searchFor = document.getElementById('searchTerm').value.toString().toUpperCase();

                        $('#databasePane').empty();
                        $('#databasePane').append('<table id="allPieces"><tr><th>Title</th><th>Composer</th><th>Arranger</th><th>Publisher</th></tr></table>');

                        for (var i = 0; i < numberOfPieces; i++) {
                            var trip = false;

                            if (searchTitle && activePieceList[i]['Title'].toUpperCase().search(searchFor) >= 0) {
                                $('#allPieces').append('<tr class="pieceSelect" id="' + i + '"><td>' + activePieceList[i]['Title'] + '</td><td>' + activePieceList[i]['Composer'] + '</td><td>' + activePieceList[i]['Arranger'] + '</td><td>' + activePieceList[i]['Publisher'] + '</td></tr>');

                                trip = true;
                            };

                            if (searchComposer && activePieceList[i]['Composer'].toUpperCase().search(searchFor) >= 0 && !trip) {
                                $('#allPieces').append('<tr class="pieceSelect" id="' + i + '"><td>' + activePieceList[i]['Title'] + '</td><td>' + activePieceList[i]['Composer'] + '</td><td>' + activePieceList[i]['Arranger'] + '</td><td>' + activePieceList[i]['Publisher'] + '</td></tr>');

                                trip = true;
                            };

                            if (searchArranger && activePieceList[i]['Arranger'].toUpperCase().search(searchFor) >= 0 && !trip) {
                                $('#allPieces').append('<tr class="pieceSelect" id="' + i + '"><td>' + activePieceList[i]['Title'] + '</td><td>' + activePieceList[i]['Composer'] + '</td><td>' + activePieceList[i]['Arranger'] + '</td><td>' + activePieceList[i]['Publisher'] + '</td></tr>');

                                trip = true;
                            };
                        };
                        createClickablePiecesANDdisplayGraph();
                    });
                };
            };

            function listOptimalPieces() {
                if (piecesLoaded) {
                    $('#databasePane').empty();
                    $('#databasePane').append('<table id="allPieces"><tr><th>Title</th><th>Composer</th><th>Arranger</th><th>Publisher</th></tr></table>');

                    for (var i = 0; i < numberOfPieces; i++) {
                        if (currentUser.elementOne == activePieceList[i]['Rapidity'] && currentUser.elementTwo == activePieceList[i]['Rhythm'] && currentUser.elementThree == activePieceList[i]['Dynamics'] && currentUser.elementFour == activePieceList[i]['Texture'] && currentUser.elementFive == activePieceList[i]['Tonality'] && currentUser.elementSix == activePieceList[i]['Range']) {
                            $('#allPieces').append('<tr class="pieceSelect" id="' + i + '"><td>' + activePieceList[i]['Title'] + '</td><td>' + activePieceList[i]['Composer'] + '</td><td>' + activePieceList[i]['Arranger'] + '</td><td>' + activePieceList[i]['Publisher'] + '</td></tr>');
                        };
                    };

                    createClickablePiecesANDdisplayGraph();
                };
            };

            function listPlayablePieces() {
                if (piecesLoaded) {
                    $('#databasePane').empty();
                    $('#databasePane').append('<table id="allPieces"><tr><th>Title</th><th>Composer</th><th>Arranger</th><th>Publisher</th></tr></table>');

                    for (var i = 0; i < numberOfPieces; i++) {
                        if (currentUser.elementOne >= activePieceList[i]['Rapidity'] && currentUser.elementTwo >= activePieceList[i]['Rhythm'] && currentUser.elementThree >= activePieceList[i]['Dynamics'] && currentUser.elementFour >= activePieceList[i]['Texture'] && currentUser.elementFive >= activePieceList[i]['Tonality'] && currentUser.elementSix >= activePieceList[i]['Range']) {
                            $('#allPieces').append('<tr class="pieceSelect" id="' + i + '"><td>' + activePieceList[i]['Title'] + '</td><td>' + activePieceList[i]['Composer'] + '</td><td>' + activePieceList[i]['Arranger'] + '</td><td>' + activePieceList[i]['Publisher'] + '</td></tr>');
                        };
                    };
                    createClickablePiecesANDdisplayGraph();
                };
            };

            function listChallengePieces() {
                if (piecesLoaded) {
                    $('#databasePane').empty();
                    $('#databasePane').append('<table id="allPieces"><tr><th>Title</th><th>Composer</th><th>Arranger</th><th>Publisher</th><th>Challenge Level</th></tr></table>');

                    var challengeLevel;

                    //Iterate through list of pieces
                    for (var i = 0; i < numberOfPieces; i++) {
                        if (!(currentUser.elementOne >= activePieceList[i]['Rapidity'] && currentUser.elementTwo >= activePieceList[i]['Rhythm'] && currentUser.elementThree >= activePieceList[i]['Dynamics'] && currentUser.elementFour >= activePieceList[i]['Texture'] && currentUser.elementFive >= activePieceList[i]['Tonality'] && currentUser.elementSix >= activePieceList[i]['Range']) && (currentUser.elementOne + 1) >= activePieceList[i]['Rapidity'] && (currentUser.elementTwo + 1) >= activePieceList[i]['Rhythm'] && (currentUser.elementThree + 1) >= activePieceList[i]['Dynamics'] && (currentUser.elementFour + 1) >= activePieceList[i]['Texture'] && (currentUser.elementFive + 1) >= activePieceList[i]['Tonality'] && (currentUser.elementSix + 1) >= activePieceList[i]['Range']) {

                            //Add 1 to challengeLevel for each challenge element
                            challengeLevel = 0;

                            if (currentUser.elementOne < activePieceList[i]['Rapidity']) {
                                challengeLevel++;
                            };
                            if (currentUser.elementTwo < activePieceList[i]['Rhythm']) {
                                challengeLevel++;
                            };
                            if (currentUser.elementThree < activePieceList[i]['Dynamics']) {
                                challengeLevel++;
                            };
                            if (currentUser.elementFour < activePieceList[i]['Texture']) {
                                challengeLevel++;
                            };
                            if (currentUser.elementFive < activePieceList[i]['Tonality']) {
                                challengeLevel++;
                            };
                            if (currentUser.elementSix < activePieceList[i]['Range']) {
                                challengeLevel++;
                            };

                            //Append Piece
                            $('#allPieces').append('<tr class="pieceSelect" id="' + i + '"><td>' + activePieceList[i]['Title'] + '</td><td>' + activePieceList[i]['Composer'] + '</td><td>' + activePieceList[i]['Arranger'] + '</td><td>' + activePieceList[i]['Publisher'] + '</td><td>' + challengeLevel + '</td></tr>');
                        };
                    };
                    createClickablePiecesANDdisplayGraph();
                };
            };

            //Login Button
            $(document).on('click', '#loginButton', function () {
                //Check login and load data
                var emailAttempt = document.getElementById('userEmail').value.toString();
                var bandAttempt = document.getElementById('userBand').value.toString();

                //Load Google Sheet "User List"
                var userList = '1Wo1RArWUmqVJ9KBjiT2W7B4Tx3KeUsy1sPYPjulcr5I';

                //Verify User, Load User Information, and Draw Graph                
                var numberOfItems = listOfUsers.length;
                var userSuccess = false;

                for (var i = 0; i < numberOfItems; i++) {

                    //Check Username
                    if (listOfUsers[i]['Email Address'] === emailAttempt) {

                        //Flag Username as Correct
                        userSuccess = true;

                        //Confirm Password
                        if (listOfUsers[i]['Band Name'] === bandAttempt) {

                            //Set Current User Info
                            currentUser.user = (listOfUsers[i]['Band Name']);
                            currentUser.elementOne = (listOfUsers[i]['Band Skill [Rapidity]'] / 1);
                            currentUser.elementTwo = (listOfUsers[i]['Band Skill [Rhythm]'] / 1);
                            currentUser.elementThree = (listOfUsers[i]['Band Skill [Dynamics]'] / 1);
                            currentUser.elementFour = (listOfUsers[i]['Band Skill [Texture]'] / 1);
                            currentUser.elementFive = (listOfUsers[i]['Band Skill [Tonality]'] / 1);
                            currentUser.elementSix = (listOfUsers[i]['Band Skill [Range]'] / 1);

                            //Cookies
                            if (!cookiesExist || !(emailAttempt == getCookie('email') && bandAttempt == getCookie('band'))) {
                                var allow = confirm('Remember information using cookies?');

                                if (allow) {
                                    setCookie('band', bandAttempt, 14);
                                    setCookie('email', emailAttempt, 14);
                                };
                            };

                            //Prepare Piece List and UI
                            $('#notesPane').append('<div class="loader"></div>');
                            $('#dataPane').empty();
                            $('#databasePane').empty();

                            loadPieces(function () {
                                addGraphCanvas();
                                createGraph();
                                $('#notesPane').empty();
                                listAllPieces();
                            });
                        }
                        else {
                            alert("Band not Found");
                        }
                    }
                    else {
                        if (i == [numberOfItems - 1] && !userSuccess) {
                            alert("Email not Found");
                        };
                    };
                };
            });
        </script>          
    </body>
</html>